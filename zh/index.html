<!DOCTYPE html><html lang="zh" data-astro-cid-qup72gqn> <head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>坎诺之路住宿</title><link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"><script defer src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script><style>.topbar[data-astro-cid-3ef6ksr2]{position:fixed;top:0;left:0;right:0;height:3rem;background:#fff;display:flex;align-items:center;justify-content:flex-end;padding:0 1rem;box-shadow:0 2px 4px #0000001a;z-index:1000;font-family:sans-serif}.topbar[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2]{margin-left:1rem;text-decoration:none;color:#333;font-weight:500}.topbar[data-astro-cid-3ef6ksr2] a[data-astro-cid-3ef6ksr2].active{font-weight:700;text-decoration:underline}body,html{margin:0;padding:0;height:100%}main[data-astro-cid-qup72gqn]{padding-top:3rem;height:calc(100% - 3rem)}
</style></head> <body data-astro-cid-qup72gqn> <nav class="topbar" data-astro-cid-3ef6ksr2> <a href="/no/" class="" data-astro-cid-3ef6ksr2>Norsk</a> <a href="/en/" class="" data-astro-cid-3ef6ksr2>English</a> <a href="/zh/" class="active" data-astro-cid-3ef6ksr2>中文</a> </nav> <main data-astro-cid-qup72gqn>  <div id="map" data-addr-label="地址" data-contact-label="联系方式" style="height:100vh;"></div> <script type="module">
  // 1) Grab the map container and its data-attributes
  const mapEl = document.getElementById('map');
  const lngCode      = mapEl.dataset.lng;
  const addrLabel    = mapEl.dataset.addrLabel;
  const contactLabel = mapEl.dataset.contactLabel;

  // 2) Parse any ?lat, ?lng, ?zoom
  const params = new URLSearchParams(window.location.search);
  const lat0  = parseFloat(params.get('lat'));
  const lng0  = parseFloat(params.get('lng'));
  const zoom0 = parseInt(params.get('zoom'));
  const hasView = !isNaN(lat0) && !isNaN(lng0) && !isNaN(zoom0);

  // 3) Init Leaflet with preserved or default view
  const map = L.map('map').setView(
    hasView ? [lat0, lng0] : [42.88, -8.4],
    hasView ? zoom0 : 9
  );
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution: '© OpenStreetMap contributors'
  }).addTo(map);

  // 4) Draw route
  fetch('/data/rute.geojson')
    .then(r => r.json())
    .then(route => {
      const layer = L.geoJSON(route, {
        style: { color: 'blue', weight: 3, opacity: 0.7 }
      }).addTo(map);
      if (!hasView) map.fitBounds(layer.getBounds());
    });

  // 5) Draw accommodations + popups
  fetch('/data/overnattinger.geojson')
    .then(r => r.json())
    .then(accs => {
      L.geoJSON(accs, {
        onEachFeature: (feature, layer) => {
          const p = feature.properties;
          const html = `
            <strong>${p.navn}</strong><br>
            <img src="/bilder/${p.bilde}" width="200"/><br>
            <b>${addrLabel}:</b> ${p.adresse}<br>
            <b>${contactLabel}:</b> ${p.kontakt}
          `;
          layer.bindPopup(html);
        }
      }).addTo(map);
    });

  // 6) Update language‐switch links to carry view params
  function updateLangLinks() {
    const center = map.getCenter();
    const zoom   = map.getZoom();
    document.querySelectorAll('.topbar a').forEach(a => {
      const url = new URL(a.href, window.location.origin);
      url.searchParams.set('lat', center.lat.toFixed(6));
      url.searchParams.set('lng', center.lng.toFixed(6));
      url.searchParams.set('zoom', zoom);
      a.href = url.pathname + url.search;
    });
  }

  map.on('moveend', updateLangLinks);
  updateLangLinks();
</script>  </main> </body></html>